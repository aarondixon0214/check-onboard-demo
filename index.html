<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employer Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .nav, .input-group { background: #f4f4f4; padding: 1rem; }
    .input-group { display: flex; gap: 1rem; align-items: center; }
    label { font-weight: bold; }
    input { padding: 0.5rem; font-size: 1rem; width: 250px; }
    select { font-size: 1rem; padding: 0.4rem; }
    .container { padding: 1rem; }
    #onboard-frame { width: 100%; height: 600px; border: none; display: none; }
  </style>
</head>
<body>
  <div class="input-group">
    <label for="api-key">API Key:</label>
    <input type="password" id="api-key" placeholder="Enter your API key" />
    <label for="company-id">Company ID:</label>
    <input type="text" id="company-id" placeholder="Enter your Company ID" />
    <label for="signatory-id">Signatory ID:</label>
    <input type="text" id="signatory-id" placeholder="Enter your Signatory ID" />
  </div>

  <div class="nav">
    <label for="payroll-dropdown">Payroll:</label>
    <select id="payroll-dropdown">
      <option value="">-- Select --</option>
      <option value="onboard">Onboard</option>
      <option value="view">View</option>
    </select>
  </div>

  <div class="container">
    <iframe id="onboard-frame"></iframe>
  </div>

  <script>
    document.getElementById('payroll-dropdown').addEventListener('change', async function (event) {
      const selected = event.target.value;
      const iframe = document.getElementById('onboard-frame');

      const apiKey = document.getElementById('api-key').value.trim();
      const companyId = document.getElementById('company-id').value.trim();
      const signatoryId = document.getElementById('signatory-id').value.trim();

      if (!apiKey || !companyId || !signatoryId) {
        alert('Please enter API key, Company ID, and Signatory ID.');
        event.target.value = "";
        return;
      }

      if (selected === 'onboard') {
        try {
          const response = await fetch(`https://sandbox.checkhq.com/v1/components/company_onboard_link`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${apiKey}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              company_id: companyId,
              signatory_id: signatoryId,
              environment: 'sandbox'
            })
          });

          const data = await response.json();
          if (data.url) {
            iframe.src = data.url;
            iframe.style.display = 'block';
          } else {
            alert('Failed to get onboarding URL');
          }
        } catch (error) {
          console.error('Error fetching onboarding link:', error);
          alert('Error generating onboarding link');
        }
      } else {
        iframe.style.display = 'none';
        iframe.src = '';
      }
    });
  </script>
</body>
</html>